<!doctype html>
<html lang="en" class="dark">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Repo Discovery</title>
		<style>
			:root {
				--bg-root: #1b1b1d;
				--bg-sidebar: #1b1b1d;
				--bg-card: #1d1d22;
				--bg-card-hover: #18181b;

				--border: #27272a;
				--border-hover: #3f3f46;

				--fg-primary: #e4e4e7;
				--fg-secondary: #a1a1aa;
				--fg-muted: #71717a;
			}

			* {
				box-sizing: border-box;
			}

			body {
				margin: 0;
				background-color: var(--bg-root);
				color: var(--fg-primary);
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
				height: 100vh;
				display: flex;
				overflow: hidden;
				font-size: 14px;
			}

			.layout {
				display: flex;
				width: 100%;
				height: 100%;
			}

			/* --- Sidebar --- */
			.sidebar {
				width: 250px;
				border-right: 1px solid var(--border);
				display: flex;
				flex-direction: column;
				background: var(--bg-sidebar);
				flex-shrink: 0;
			}

			.sidebar-header {
				height: 57px;
				display: flex;
				align-items: center;
				padding: 0 1.25rem;
				font-weight: 600;
				border-bottom: 1px solid var(--border);
				color: var(--fg-primary);
			}

			.nav-list {
				flex: 1;
				overflow-y: auto;
				padding: 0.75rem;
				list-style: none;
				margin: 0;
			}

			.nav-item {
				padding: 0.6rem 0.875rem;
				border-radius: 6px;
				color: var(--fg-secondary);
				cursor: pointer;
				margin-bottom: 4px;
				transition: all 0.15s;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.nav-item:hover {
				background: var(--bg-card-hover);
				color: var(--fg-primary);
			}

			.nav-item.active {
				background: #27272a;
				color: var(--fg-primary);
				font-weight: 500;
			}

			.badge {
				font-size: 11px;
				background: #18181b;
				border: 1px solid #27272a;
				padding: 1px 6px;
				border-radius: 99px;
				color: var(--fg-muted);
			}

			.main {
				flex: 1;
				display: flex;
				flex-direction: column;
				background: var(--bg-root);
				min-width: 0;
			}

			.top-bar {
				height: 57px;
				border-bottom: 1px solid var(--border);
				display: flex;
				align-items: center;
				justify-content: space-between;
				padding: 0 1.5rem;
				background: var(--bg-root);
				z-index: 10;
			}

			.page-title {
				font-weight: 600;
				font-size: 14px;
				color: var(--fg-primary);
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
				margin-right: 1.5rem;
			}

			.search-container {
				position: relative;
				width: 280px;
			}

			.search-input {
				width: 100%;
				background: #18181b;
				border: 1px solid var(--border);
				color: var(--fg-primary);
				padding: 0.45rem 0.875rem;
				border-radius: 6px;
				font-size: 13px;
				transition: all 0.15s;
			}

			.search-input:focus {
				outline: none;
				border-color: #52525b;
				background: #1c1c21;
			}

			/* --- Grid --- */
			.content-area {
				flex: 1;
				overflow-y: auto;
				padding: 1.5rem;
			}

			.grid {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
				gap: 1rem;
			}

			.card {
				border: 1px solid var(--border);
				background: var(--bg-card);
				border-radius: 8px;
				padding: 1.25rem;
				display: flex;
				flex-direction: row;
				justify-content: space-between;
				align-items: center;
				gap: 1.5rem;
				transition: all 0.15s;
			}

			.card:hover {
				border-color: var(--border-hover);
				background: var(--bg-card-hover);
			}

			.card-info {
				flex: 1;
				min-width: 0;
			}

			.repo-link {
				font-weight: 600;
				color: var(--fg-primary);
				text-decoration: none;
				font-size: 15px;
				word-break: break-all;
				display: block;
				margin-bottom: 1rem;
			}
			.repo-link:hover {
				text-decoration: underline;
			}

			.stats-row {
				display: flex;
				align-items: center;
				gap: 16px;
				font-size: 12px;
				color: var(--fg-secondary);
			}

			.stat-item {
				display: flex;
				align-items: center;
				gap: 4px;
			}

			.stat-icon {
				opacity: 0.5;
				width: 14px;
				height: 14px;
			}

			/* --- Mobile --- */
			.menu-btn {
				display: none;
			}
			.overlay {
				display: none;
			}

			@media (max-width: 768px) {
				.sidebar {
					position: fixed;
					top: 0;
					bottom: 0;
					left: 0;
					z-index: 50;
					transform: translateX(-100%);
					transition: transform 0.2s;
				}
				.sidebar.open {
					transform: translateX(0);
				}

				.overlay {
					display: block;
					position: fixed;
					inset: 0;
					background: rgba(0, 0, 0, 0.5);
					z-index: 40;
					opacity: 0;
					pointer-events: none;
					transition: opacity 0.2s;
				}
				.overlay.open {
					opacity: 1;
					pointer-events: auto;
				}

				.menu-btn {
					display: block;
					background: none;
					border: none;
					color: var(--fg-primary);
					font-size: 1.25rem;
					cursor: pointer;
					margin-right: 0.75rem;
				}

				.top-bar {
					height: auto;
					flex-direction: column;
					align-items: stretch;
					padding: 0.75rem 1rem;
					gap: 0.75rem;
				}

				.top-bar-title-row {
					display: flex;
					align-items: center;
				}

				.content-area {
					padding: 1rem;
				}
				.search-container {
					width: 100%;
				}
				.grid {
					grid-template-columns: 1fr;
				}
				.card {
					flex-direction: column;
					align-items: flex-start;
					gap: 0.75rem;
				}
			}
		</style>
	</head>
	<body>
		<div class="layout">
			<div class="overlay" id="overlay"></div>

			<aside class="sidebar" id="sidebar">
				<div class="sidebar-header">RepoDiscovery</div>
				<div class="nav-list" id="nav-list"></div>
			</aside>

			<div class="main">
				<header class="top-bar">
					<div class="top-bar-title-row">
						<button class="menu-btn" id="menu-btn">â˜°</button>
						<div class="page-title" id="page-title">Loading...</div>
					</div>
					<div class="search-container">
						<input type="text" id="search" class="search-input" placeholder="Filter repositories..." />
					</div>
				</header>

				<div class="content-area">
					<div class="grid" id="grid"></div>
				</div>
			</div>
		</div>

		<script>
			document.addEventListener("DOMContentLoaded", () => {
				const state = {
					data: null,
					activeIdx: 0,
					filter: "",
				};

				const els = {
					nav: document.getElementById("nav-list"),
					grid: document.getElementById("grid"),
					title: document.getElementById("page-title"),
					search: document.getElementById("search"),
					sidebar: document.getElementById("sidebar"),
					overlay: document.getElementById("overlay"),
					menuBtn: document.getElementById("menu-btn"),
				};

				const toggleMenu = () => {
					els.sidebar.classList.toggle("open");
					els.overlay.classList.toggle("open");
				};
				els.menuBtn.onclick = toggleMenu;
				els.overlay.onclick = toggleMenu;

				fetch("recommendations/latest.json")
					.then((r) => r.json())
					.then((d) => {
						state.data = d;
						render();
					});

				els.search.addEventListener("input", (e) => {
					state.filter = e.target.value.toLowerCase();
					render();
				});

				function render() {
					if (!state.data) return;
					renderNav();
					renderContent();
				}

				function renderNav() {
					els.nav.innerHTML = "";
					state.data.results.forEach((g, i) => {
						const match = g.repo.toLowerCase().includes(state.filter) || g.recommendations.some((r) => r.repo.toLowerCase().includes(state.filter));
						if (state.filter && !match) return;

						const item = document.createElement("div");
						item.className = `nav-item ${i === state.activeIdx ? "active" : ""}`;
						item.innerHTML = `
                    <span style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap; margin-right:8px;">
                        ${g.repo.split("/")[1]}
                    </span>
                    <span class="badge">${g.recommendations.length}</span>
                `;
						item.onclick = () => {
							state.activeIdx = i;
							renderContent();
							renderNav();
							if (window.innerWidth <= 768) toggleMenu();
						};
						els.nav.appendChild(item);
					});
				}

				function renderContent() {
					const group = state.data.results[state.activeIdx];
					if (!group) return;

					els.title.textContent = group.repo;
					els.grid.innerHTML = "";

					const filtered = group.recommendations.filter((r) => r.repo.toLowerCase().includes(state.filter) || group.repo.toLowerCase().includes(state.filter));

					const fmt = (n) => new Intl.NumberFormat("en-US", { notation: "compact" }).format(n);

					if (filtered.length === 0) {
						els.grid.innerHTML = `<div style="color:var(--fg-muted)">No results found.</div>`;
						return;
					}

					filtered.forEach((rec) => {
						const card = document.createElement("div");
						card.className = "card";
						card.innerHTML = `
                    <div class="card-info">
                        <a href="https://github.com/${rec.repo}" target="_blank" class="repo-link">${rec.repo}</a>
                        <div class="stats-row">
                            <div class="stat-item" title="Stars">
                                <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                                <span>${fmt(rec.total_stars)} Stars</span>
                            </div>
                            <div class="stat-item" title="Forks">
                                <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="6" y1="3" x2="6" y2="15"></line><circle cx="18" cy="6" r="3"></circle><circle cx="6" cy="18" r="3"></circle><path d="M18 9a9 9 0 0 1-9 9"></path></svg>
                                <span>${fmt(rec.forks)} Forks</span>
                            </div>
                        </div>
                    </div>
                `;
						els.grid.appendChild(card);
					});
				}
			});
		</script>
	</body>
</html>
